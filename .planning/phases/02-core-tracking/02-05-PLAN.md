---
phase: 02-core-tracking
plan: 05
type: execute
wave: 4
depends_on: ["02-02", "02-03", "02-04"]
files_modified:
  - app/(app)/_layout.tsx
  - app/(app)/index.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate between Home, Hobbies, and Profile tabs"
    - "User can complete full flow: create profile -> create hobby -> log progress -> see stats"
    - "All features work together without errors"
    - "Data persists across navigation and app restart"
  artifacts:
    - path: "app/(app)/_layout.tsx"
      provides: "Tab navigation layout"
      min_lines: 30
    - path: "app/(app)/index.tsx"
      provides: "Home screen with quick actions"
      min_lines: 40
  key_links:
    - from: "app/(app)/_layout.tsx"
      to: "app/(app)/hobbies/index.tsx"
      via: "Tab navigation"
      pattern: "Tabs\\.Screen.*hobbies"
    - from: "app/(app)/index.tsx"
      to: "useHobbies|useMyProfile"
      via: "data fetching"
      pattern: "use(Hobbies|MyProfile)"
---

<objective>
Integrate all Phase 2 features with tab navigation and verify the complete user flow works end-to-end.

Purpose: Connect all the pieces (profile, hobbies, logs, stats) into a cohesive app experience and verify everything works together.
Output: Tab-based navigation, integrated home screen, and verified complete user flow.
</objective>

<execution_context>
@/Users/tim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-tracking/02-RESEARCH.md

# All Phase 2 features
# @src/features/profiles/ (from 02-02)
# @src/features/hobbies/ (from 02-03)
# @src/features/logs/ (from 02-04)
# @src/features/stats/ (from 02-04)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tab navigation layout</name>
  <files>
    app/(app)/_layout.tsx
  </files>
  <action>
Update `app/(app)/_layout.tsx` to use tab navigation:

```typescript
import { Tabs, Redirect } from 'expo-router'
import { useAuth } from '@/features/auth'
import { View, ActivityIndicator } from 'react-native'

export default function AppLayout() {
  const { user, isLoading } = useAuth()

  if (isLoading) {
    return (
      <View className="flex-1 items-center justify-center">
        <ActivityIndicator size="large" />
      </View>
    )
  }

  if (!user) {
    return <Redirect href="/(auth)/login" />
  }

  return (
    <Tabs
      screenOptions={{
        tabBarActiveTintColor: '#3B82F6',
        headerShown: true,
      }}
    >
      <Tabs.Screen
        name="index"
        options={{
          title: 'Home',
          tabBarLabel: 'Home',
        }}
      />
      <Tabs.Screen
        name="hobbies"
        options={{
          title: 'Hobbies',
          tabBarLabel: 'Hobbies',
          headerShown: false, // Stack handles its own header
        }}
      />
      <Tabs.Screen
        name="profile"
        options={{
          title: 'Profile',
          tabBarLabel: 'Profile',
          headerShown: false, // Stack handles its own header
        }}
      />
    </Tabs>
  )
}
```

Note: The hobbies and profile directories already have their own _layout.tsx with Stack navigation. The tabs will show the root of each stack.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Tab navigation structure in place
  </verify>
  <done>
Tab navigation with Home, Hobbies, Profile tabs. Each tab shows its respective feature.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create integrated home screen</name>
  <files>
    app/(app)/index.tsx
  </files>
  <action>
Update `app/(app)/index.tsx` to be a dashboard:

```typescript
import { View, Text, ScrollView, Pressable, ActivityIndicator } from 'react-native'
import { Link } from 'expo-router'
import { useAuth } from '@/features/auth'
import { useMyProfile } from '@/features/profiles'
import { useHobbies } from '@/features/hobbies'
import { signOut } from '@/features/auth'

export default function HomeScreen() {
  const { user } = useAuth()
  const { data: profile, isLoading: profileLoading } = useMyProfile()
  const { data: hobbies, isLoading: hobbiesLoading } = useHobbies()

  const isLoading = profileLoading || hobbiesLoading

  if (isLoading) {
    return (
      <View className="flex-1 items-center justify-center">
        <ActivityIndicator size="large" />
      </View>
    )
  }

  const recentHobbies = hobbies?.slice(0, 3) ?? []
  const hasProfile = !!profile?.username

  return (
    <ScrollView className="flex-1 bg-white">
      <View className="p-4">
        {/* Welcome Section */}
        <Text className="text-2xl font-bold mb-2">
          Welcome{profile?.username ? `, ${profile.username}` : ''}!
        </Text>

        {/* Profile CTA if not set up */}
        {!hasProfile && (
          <Link href="/profile/edit" asChild>
            <Pressable className="bg-blue-50 p-4 rounded-lg mb-4 border border-blue-200">
              <Text className="text-blue-700 font-medium">Complete your profile</Text>
              <Text className="text-blue-600 text-sm">Add a username and avatar to get started</Text>
            </Pressable>
          </Link>
        )}

        {/* Quick Stats */}
        <View className="bg-gray-50 p-4 rounded-lg mb-4">
          <Text className="text-lg font-semibold mb-2">Your Progress</Text>
          <Text className="text-gray-600">
            {hobbies?.length ?? 0} hobbies tracked
          </Text>
        </View>

        {/* Recent Hobbies */}
        <View className="mb-4">
          <View className="flex-row justify-between items-center mb-2">
            <Text className="text-lg font-semibold">Recent Hobbies</Text>
            <Link href="/hobbies" asChild>
              <Pressable>
                <Text className="text-blue-500">See all</Text>
              </Pressable>
            </Link>
          </View>

          {recentHobbies.length === 0 ? (
            <Link href="/hobbies/new" asChild>
              <Pressable className="bg-gray-50 p-4 rounded-lg border border-dashed border-gray-300">
                <Text className="text-gray-600 text-center">
                  No hobbies yet. Tap to create your first!
                </Text>
              </Pressable>
            </Link>
          ) : (
            recentHobbies.map((hobby) => (
              <Link key={hobby.id} href={`/hobbies/${hobby.id}`} asChild>
                <Pressable className="bg-white p-3 rounded-lg border border-gray-200 mb-2">
                  <Text className="font-medium">{hobby.name}</Text>
                  <Text className="text-gray-500 text-sm capitalize">
                    {hobby.tracking_type} tracking
                  </Text>
                </Pressable>
              </Link>
            ))
          )}
        </View>

        {/* Quick Actions */}
        <View className="flex-row gap-2">
          <Link href="/hobbies/new" asChild>
            <Pressable className="flex-1 bg-blue-500 p-3 rounded-lg">
              <Text className="text-white text-center font-medium">New Hobby</Text>
            </Pressable>
          </Link>
          <Pressable
            onPress={() => signOut()}
            className="flex-1 bg-gray-200 p-3 rounded-lg"
          >
            <Text className="text-gray-700 text-center font-medium">Sign Out</Text>
          </Pressable>
        </View>
      </View>
    </ScrollView>
  )
}
```
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
Home screen shows welcome message, profile CTA (if needed), hobby count, recent hobbies, and quick actions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete user flow</name>
  <what-built>
Complete Phase 2: Core Tracking feature set including:
- Profile management (view, edit, avatar upload)
- Hobby CRUD (create, read, update, delete)
- Log entries with photo attachments
- Progress stats and visualization
- Tab navigation between Home, Hobbies, Profile
  </what-built>
  <how-to-verify>
1. Start the app: `npx expo start`
2. Log in with an existing account (or create new one)

**Profile Flow:**
3. Navigate to Profile tab
4. If new user: Should see "Complete Your Profile" prompt
5. Tap to edit profile, add username and bio
6. Pick an avatar (select photo from library)
7. Save - should return to profile view with new data

**Hobby Flow:**
8. Navigate to Hobbies tab
9. Tap "+" or "New Hobby" to create a hobby
10. Fill in: name "Running", tracking type "time", goal "1000" minutes
11. Save - should appear in hobbies list
12. Tap the hobby to view details

**Logging Flow:**
13. On hobby detail, tap "Log Progress"
14. Enter value (e.g., 30 minutes)
15. Add a note (optional)
16. Pick a photo (optional)
17. Save - should return to hobby detail
18. Verify: log appears in history, stats updated (30/1000, 3%)

**Persistence:**
19. Close and reopen the app
20. Verify: profile, hobbies, and logs are all still there

**Expected Behavior:**
- All navigation works without errors
- Forms validate input correctly
- Optimistic updates show changes immediately
- Stats calculate correctly
- Photos upload and display properly
  </how-to-verify>
  <resume-signal>Type "approved" if all flows work correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Tab navigation works between Home, Hobbies, Profile
2. Profile can be created and edited with avatar
3. Hobbies can be created, viewed, edited, deleted
4. Logs can be created with photos and deleted
5. Stats update correctly when logs are added/removed
6. Data persists across app restarts
</verification>

<success_criteria>
- User can complete full onboarding: signup -> create profile -> create hobby -> log progress
- Tab navigation provides easy access to all features
- All CRUD operations work correctly with optimistic updates
- Stats (total, count, percentage) calculate and display correctly
- Photo uploads work for both avatars and log photos
- Data persists across navigation and app restart
- No TypeScript errors or runtime crashes
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-tracking/02-05-SUMMARY.md`
</output>
