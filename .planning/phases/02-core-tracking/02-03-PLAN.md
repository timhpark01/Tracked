---
phase: 02-core-tracking
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/features/hobbies/services/hobbies.service.ts
  - src/features/hobbies/hooks/useHobbies.ts
  - src/features/hobbies/hooks/useHobby.ts
  - src/features/hobbies/hooks/useCreateHobby.ts
  - src/features/hobbies/hooks/useUpdateHobby.ts
  - src/features/hobbies/hooks/useDeleteHobby.ts
  - src/features/hobbies/components/HobbyCard.tsx
  - src/features/hobbies/components/HobbyForm.tsx
  - src/features/hobbies/components/HobbyList.tsx
  - src/features/hobbies/index.ts
  - app/(app)/hobbies/index.tsx
  - app/(app)/hobbies/new.tsx
  - app/(app)/hobbies/[id].tsx
  - app/(app)/hobbies/[id]/edit.tsx
autonomous: true

must_haves:
  truths:
    - "User can see list of their hobbies"
    - "User can create a new hobby with name, tracking type, and optional goal"
    - "User can edit an existing hobby"
    - "User can delete a hobby"
    - "Hobbies persist across app restarts"
  artifacts:
    - path: "src/features/hobbies/services/hobbies.service.ts"
      provides: "CRUD functions for hobbies"
      min_lines: 50
    - path: "src/features/hobbies/hooks/useHobbies.ts"
      provides: "Hook to list user hobbies"
      min_lines: 15
    - path: "src/features/hobbies/hooks/useCreateHobby.ts"
      provides: "Mutation hook with optimistic update"
      min_lines: 30
    - path: "app/(app)/hobbies/index.tsx"
      provides: "Hobby list screen"
      min_lines: 40
    - path: "app/(app)/hobbies/new.tsx"
      provides: "Create hobby screen"
      min_lines: 40
  key_links:
    - from: "app/(app)/hobbies/index.tsx"
      to: "useHobbies"
      via: "hook call"
      pattern: "useHobbies\\(\\)"
    - from: "src/features/hobbies/hooks/useCreateHobby.ts"
      to: "src/features/hobbies/services/hobbies.service.ts"
      via: "service call"
      pattern: "createHobby"
---

<objective>
Build the complete Hobby feature with service layer, hooks with optimistic updates, and screens for listing, creating, editing, and deleting hobbies.

Purpose: Users need to create and manage hobbies to track (HOBB-01 through HOBB-06). Hobbies are the core entity that logs are recorded against.
Output: Hobby service, all CRUD hooks, form/list components, and screens for the full hobby management flow.
</objective>

<execution_context>
@/Users/tim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-tracking/02-RESEARCH.md

# Phase 1 patterns
@src/features/auth/hooks/useAuth.ts
@src/features/auth/services/auth.service.ts
@src/lib/supabase.ts
@src/types/database.ts

# Phase 2 infrastructure (from 02-01)
# @src/components/forms/index.ts (will exist after 02-01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create hobby service and query hooks</name>
  <files>
    src/features/hobbies/services/hobbies.service.ts
    src/features/hobbies/hooks/useHobbies.ts
    src/features/hobbies/hooks/useHobby.ts
  </files>
  <action>
1. Create `src/features/hobbies/services/hobbies.service.ts`:
   ```typescript
   import { supabase } from '@/lib/supabase'
   import type { Database } from '@/types/database'

   type Hobby = Database['public']['Tables']['hobbies']['Row']
   type HobbyInsert = Database['public']['Tables']['hobbies']['Insert']
   type HobbyUpdate = Database['public']['Tables']['hobbies']['Update']

   export async function getHobbies(userId: string): Promise<Hobby[]> {
     const { data, error } = await supabase
       .from('hobbies')
       .select('*')
       .eq('user_id', userId)
       .order('created_at', { ascending: false })

     if (error) throw error
     return data
   }

   export async function getHobby(hobbyId: string): Promise<Hobby> {
     const { data, error } = await supabase
       .from('hobbies')
       .select('*')
       .eq('id', hobbyId)
       .single()

     if (error) throw error
     return data
   }

   export async function createHobby(hobby: HobbyInsert): Promise<Hobby> {
     const { data, error } = await supabase
       .from('hobbies')
       .insert(hobby)
       .select()
       .single()

     if (error) throw error
     return data
   }

   export async function updateHobby(hobbyId: string, updates: HobbyUpdate): Promise<Hobby> {
     const { data, error } = await supabase
       .from('hobbies')
       .update(updates)
       .eq('id', hobbyId)
       .select()
       .single()

     if (error) throw error
     return data
   }

   export async function deleteHobby(hobbyId: string): Promise<void> {
     const { error } = await supabase
       .from('hobbies')
       .delete()
       .eq('id', hobbyId)

     if (error) throw error
   }
   ```

2. Create `src/features/hobbies/hooks/useHobbies.ts`:
   - Query key: `['hobbies', user?.id]`
   - Fetch using `getHobbies(user!.id)`
   - `enabled: !!user`

3. Create `src/features/hobbies/hooks/useHobby.ts`:
   - Accept `hobbyId: string` parameter
   - Query key: `['hobby', hobbyId]`
   - Fetch using `getHobby(hobbyId)`
   - `enabled: !!hobbyId`
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Service file has all 5 functions: `grep -c "export async function" src/features/hobbies/services/hobbies.service.ts`
  </verify>
  <done>
Hobby service exports getHobbies, getHobby, createHobby, updateHobby, deleteHobby. Query hooks useHobbies and useHobby ready.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create hobby mutation hooks with optimistic updates</name>
  <files>
    src/features/hobbies/hooks/useCreateHobby.ts
    src/features/hobbies/hooks/useUpdateHobby.ts
    src/features/hobbies/hooks/useDeleteHobby.ts
    src/features/hobbies/index.ts
  </files>
  <action>
1. Create `src/features/hobbies/hooks/useCreateHobby.ts` with optimistic update:
   ```typescript
   import { useMutation, useQueryClient } from '@tanstack/react-query'
   import { createHobby } from '../services/hobbies.service'
   import { useAuth } from '@/features/auth'
   import type { Database } from '@/types/database'

   type Hobby = Database['public']['Tables']['hobbies']['Row']
   type HobbyInsert = Database['public']['Tables']['hobbies']['Insert']

   export function useCreateHobby() {
     const { user } = useAuth()
     const queryClient = useQueryClient()

     return useMutation({
       mutationFn: createHobby,
       onMutate: async (newHobby: HobbyInsert) => {
         await queryClient.cancelQueries({ queryKey: ['hobbies', user?.id] })
         const previousHobbies = queryClient.getQueryData<Hobby[]>(['hobbies', user?.id])

         const optimisticHobby: Hobby = {
           ...newHobby,
           id: `temp-${Date.now()}`,
           created_at: new Date().toISOString(),
           description: newHobby.description ?? null,
           category: newHobby.category ?? null,
           goal_total: newHobby.goal_total ?? null,
           goal_unit: newHobby.goal_unit ?? null,
         } as Hobby

         queryClient.setQueryData<Hobby[]>(
           ['hobbies', user?.id],
           (old = []) => [optimisticHobby, ...old]
         )

         return { previousHobbies }
       },
       onError: (_err, _newHobby, context) => {
         if (context?.previousHobbies) {
           queryClient.setQueryData(['hobbies', user?.id], context.previousHobbies)
         }
       },
       onSettled: () => {
         queryClient.invalidateQueries({ queryKey: ['hobbies', user?.id] })
       },
     })
   }
   ```

2. Create `src/features/hobbies/hooks/useUpdateHobby.ts`:
   - Accept `hobbyId` in mutation input
   - Optimistically update the hobby in cache
   - Invalidate both `['hobbies', userId]` and `['hobby', hobbyId]` on settle

3. Create `src/features/hobbies/hooks/useDeleteHobby.ts`:
   - Accept `hobbyId` parameter
   - Optimistically remove from cache
   - Invalidate on settle

4. Create `src/features/hobbies/index.ts` with barrel exports:
   ```typescript
   export { useHobbies } from './hooks/useHobbies'
   export { useHobby } from './hooks/useHobby'
   export { useCreateHobby } from './hooks/useCreateHobby'
   export { useUpdateHobby } from './hooks/useUpdateHobby'
   export { useDeleteHobby } from './hooks/useDeleteHobby'
   export * from './services/hobbies.service'
   ```
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
All hooks exported: `grep "export {" src/features/hobbies/index.ts`
  </verify>
  <done>
All mutation hooks implement optimistic updates with proper rollback. Barrel exports all hooks and service functions.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create hobby components and screens</name>
  <files>
    src/features/hobbies/components/HobbyCard.tsx
    src/features/hobbies/components/HobbyForm.tsx
    src/features/hobbies/components/HobbyList.tsx
    app/(app)/hobbies/_layout.tsx
    app/(app)/hobbies/index.tsx
    app/(app)/hobbies/new.tsx
    app/(app)/hobbies/[id].tsx
    app/(app)/hobbies/[id]/edit.tsx
  </files>
  <action>
1. Create `src/features/hobbies/components/HobbyCard.tsx`:
   - Props: `hobby: Hobby`, `onPress?: () => void`
   - Display name, tracking type badge, goal if set
   - NativeWind: card styling with shadow, rounded corners

2. Create `src/features/hobbies/components/HobbyForm.tsx`:
   - Zod schema:
     - `name`: required, 1-100 chars
     - `tracking_type`: enum 'time' | 'quantity'
     - `goal_total`: optional positive number
     - `goal_unit`: optional string (shown when tracking_type is 'quantity')
     - `description`: optional, max 500 chars
   - Props: `initialData?`, `onSubmit`, `isLoading`
   - Use ControlledInput, radio/toggle for tracking_type
   - Conditionally show goal_unit when tracking_type === 'quantity'

3. Create `src/features/hobbies/components/HobbyList.tsx`:
   - Props: `hobbies: Hobby[]`, `onHobbyPress: (id) => void`
   - FlatList of HobbyCard components
   - Empty state: "No hobbies yet. Create your first one!"

4. Create `app/(app)/hobbies/_layout.tsx`:
   - Stack layout with header

5. Create `app/(app)/hobbies/index.tsx`:
   - Use `useHobbies()` to get data
   - Show loading spinner while fetching
   - Render `HobbyList` with navigation to hobby detail
   - FAB or header button to navigate to `/hobbies/new`

6. Create `app/(app)/hobbies/new.tsx`:
   - Use `useCreateHobby()`
   - Show `HobbyForm`
   - On submit, create hobby and navigate back to list
   - Handle errors with alert

7. Create `app/(app)/hobbies/[id].tsx`:
   - Use `useLocalSearchParams()` to get `id`
   - Use `useHobby(id)` to get hobby details
   - Show hobby name, description, tracking type, goal
   - "Edit" button -> `/hobbies/[id]/edit`
   - "Delete" button with confirmation -> delete and navigate back
   - "Log Progress" button (placeholder for now, will connect in 02-04)

8. Create `app/(app)/hobbies/[id]/edit.tsx`:
   - Use `useHobby(id)` and `useUpdateHobby()`
   - Show `HobbyForm` with initial data
   - On submit, update and navigate back

9. Update `app/(app)/index.tsx`:
   - Add "My Hobbies" link/button to navigate to `/hobbies`
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
All files exist: `ls app/\(app\)/hobbies/`
  </verify>
  <done>
Full hobby CRUD flow: list hobbies, create new, view detail, edit, delete. All screens connected with proper navigation.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - compiles without errors
2. `ls src/features/hobbies/` - service, hooks, components directories exist
3. `ls app/\(app\)/hobbies/` - all screen files exist
4. Manually test: Create hobby -> Edit -> Delete -> Verify list updates
</verification>

<success_criteria>
- Hobby service with all CRUD functions
- All hooks (useHobbies, useHobby, useCreateHobby, useUpdateHobby, useDeleteHobby) exported
- Mutation hooks implement optimistic updates with rollback
- Hobby list screen shows all user hobbies
- Create hobby screen validates and creates hobbies
- Hobby detail screen shows info and allows edit/delete
- Hobbies persist across app restarts
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-tracking/02-03-SUMMARY.md`
</output>
