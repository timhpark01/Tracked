---
phase: 03-social-graph
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - app/(app)/search/index.tsx
  - app/(app)/search/_layout.tsx
  - app/(app)/_layout.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to search screen from tab bar"
    - "User can type username and see matching results"
    - "Search only triggers after 2+ characters"
    - "Tapping a search result navigates to that user's profile"
    - "User sees empty state when no results found"
  artifacts:
    - path: "app/(app)/search/index.tsx"
      provides: "User search screen with input and results"
      min_lines: 80
    - path: "app/(app)/search/_layout.tsx"
      provides: "Search stack navigator"
      min_lines: 10
  key_links:
    - from: "app/(app)/search/index.tsx"
      to: "src/features/social"
      via: "import useSearchUsers"
      pattern: "import.*useSearchUsers.*from.*@/features/social"
    - from: "app/(app)/search/index.tsx"
      to: "app/(app)/profile/[userId].tsx"
      via: "router.push navigation"
      pattern: "router\\.push.*profile/"
---

<objective>
Create the user search screen with debounced input and results list.

Purpose: Enables user discovery (SOCL-05) by allowing users to search for others by username.

Output: Search tab with functional username search and navigation to user profiles.
</objective>

<execution_context>
@/Users/tim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-social-graph/03-01-SUMMARY.md

# UI patterns to follow
@app/(app)/profile/index.tsx
@app/(app)/hobbies/index.tsx
@app/(app)/_layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create search screen and layout</name>
  <files>
app/(app)/search/_layout.tsx
app/(app)/search/index.tsx
  </files>
  <action>
**_layout.tsx** - Create simple stack navigator:
```typescript
import { Stack } from 'expo-router'

export default function SearchLayout() {
  return (
    <Stack>
      <Stack.Screen name="index" options={{ title: 'Search' }} />
    </Stack>
  )
}
```

**index.tsx** - Create search screen with:

1. **State:**
   - searchQuery: string state with useState
   - debouncedQuery: string (debounce searchQuery by 300ms using useEffect + setTimeout)

2. **Query:**
   - Use useSearchUsers(debouncedQuery) from @/features/social
   - Destructure: data: users, isLoading, isFetching

3. **UI structure:**
   - TextInput for search (placeholder: "Search by username...")
   - Style with border, padding, margin
   - Show loading indicator when isFetching AND debouncedQuery.length >= 2
   - FlatList of results (or empty state)

4. **Empty states:**
   - If debouncedQuery.length < 2: "Type at least 2 characters to search"
   - If debouncedQuery.length >= 2 && !isLoading && users?.length === 0: "No users found"

5. **Result item:**
   - Pressable wrapping avatar + username
   - Avatar: Image if avatar_url, otherwise placeholder with initial
   - Username displayed as @username
   - onPress: router.push(`/profile/${user.id}`)

6. **Styling:**
   - Use StyleSheet (consistent with existing screens)
   - White background, proper spacing
   - Search input with border, rounded corners
   - Result items with padding, border-bottom

Debounce implementation (without external library):
```typescript
const [debouncedQuery, setDebouncedQuery] = useState('')

useEffect(() => {
  const timer = setTimeout(() => {
    setDebouncedQuery(searchQuery)
  }, 300)
  return () => clearTimeout(timer)
}, [searchQuery])
```
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/tim/Documents/GitHub/Tracked && npx tsc --noEmit
```

Files exist:
```bash
ls app/(app)/search/
```
Should show _layout.tsx and index.tsx.
  </verify>
  <done>
Search screen renders with input field, shows loading state during search, displays results or appropriate empty states. Tapping result navigates to profile.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add search tab to navigation</name>
  <files>app/(app)/_layout.tsx</files>
  <action>
Update the main app layout to add Search as a tab:

1. Add a new Tabs.Screen for search:
```typescript
<Tabs.Screen
  name="search"
  options={{
    title: 'Search',
    headerShown: false,
    tabBarIcon: ({ color, size }) => (
      <Ionicons name="search" size={size} color={color} />
    ),
  }}
/>
```

2. Position search tab between hobbies and profile (or as makes sense for the existing tab order).

3. Ensure Ionicons is imported (should already be from existing tabs).

Tab order should be: Hobbies | Search | Profile (or similar logical order).
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/tim/Documents/GitHub/Tracked && npx tsc --noEmit
```

Verify tab is added:
```bash
grep -c "search" app/(app)/_layout.tsx
```
Should return 2+ (name and title references).
  </verify>
  <done>
Search tab appears in bottom navigation. Tapping it shows the search screen. Tab icon is a magnifying glass.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Files exist:**
```bash
ls -la app/(app)/search/
```

2. **Navigation includes search:**
```bash
grep "search" app/(app)/_layout.tsx
```

3. **TypeScript:**
```bash
npx tsc --noEmit
```

4. **Manual verification:** Run app, verify search tab appears and search functionality works.
</verification>

<success_criteria>
- Search tab appears in bottom navigation with magnifying glass icon
- Search screen shows text input for username
- Typing triggers debounced search (300ms delay)
- Results display as list with avatar and @username
- Tapping result navigates to /profile/[userId]
- Empty states show for no input and no results
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-social-graph/03-02-SUMMARY.md`
</output>
