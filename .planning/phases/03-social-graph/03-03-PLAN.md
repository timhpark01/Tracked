---
phase: 03-social-graph
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - app/(app)/profile/followers.tsx
  - app/(app)/profile/following.tsx
  - app/(app)/profile/[userId].tsx
  - app/(app)/profile/_layout.tsx
autonomous: true

must_haves:
  truths:
    - "User can see follow/unfollow button on other users' profiles"
    - "Follow button is hidden on own profile"
    - "Tapping follow changes button to unfollow (optimistic)"
    - "User can navigate to followers list from profile"
    - "User can navigate to following list from profile"
    - "Followers/following lists show user avatars and usernames"
    - "Tapping user in list navigates to their profile"
  artifacts:
    - path: "app/(app)/profile/followers.tsx"
      provides: "Followers list screen"
      min_lines: 60
    - path: "app/(app)/profile/following.tsx"
      provides: "Following list screen"
      min_lines: 60
    - path: "app/(app)/profile/[userId].tsx"
      provides: "User profile with follow button"
      contains: "useFollowUser"
  key_links:
    - from: "app/(app)/profile/[userId].tsx"
      to: "src/features/social"
      via: "import useIsFollowing, useFollowUser, useUnfollowUser"
      pattern: "import.*from.*@/features/social"
    - from: "app/(app)/profile/followers.tsx"
      to: "src/features/social"
      via: "import useFollowers"
      pattern: "import.*useFollowers.*from.*@/features/social"
---

<objective>
Add follow/unfollow functionality to user profiles and create followers/following list screens.

Purpose: Enables core social graph functionality (SOCL-01 through SOCL-04) - following users and viewing follow relationships.

Output: Follow button on profiles, followers list screen, following list screen with navigation.
</objective>

<execution_context>
@/Users/tim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-social-graph/03-01-SUMMARY.md

# Existing profile screens to modify
@app/(app)/profile/[userId].tsx
@app/(app)/profile/_layout.tsx
@app/(app)/profile/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add follow button to user profile screen</name>
  <files>app/(app)/profile/[userId].tsx</files>
  <action>
Update the [userId].tsx screen to add follow/unfollow functionality:

1. **Import hooks:**
```typescript
import { useIsFollowing, useFollowUser, useUnfollowUser } from '@/features/social'
```

2. **Add hooks in component:**
```typescript
const { data: isFollowing, isLoading: checkingFollow } = useIsFollowing(userId || '')
const followMutation = useFollowUser()
const unfollowMutation = useUnfollowUser()

const isPending = followMutation.isPending || unfollowMutation.isPending
```

3. **Add handleFollow function:**
```typescript
const handleFollow = () => {
  if (!userId) return
  if (isFollowing) {
    unfollowMutation.mutate({ followingId: userId })
  } else {
    followMutation.mutate({ followingId: userId })
  }
}
```

4. **Add follow button below bio** (before the closing ScrollView):
```typescript
{/* Follow button - only show if not loading */}
{!checkingFollow && (
  <Pressable
    style={[
      styles.followButton,
      isFollowing && styles.followButtonFollowing,
      isPending && styles.followButtonDisabled,
    ]}
    onPress={handleFollow}
    disabled={isPending}
  >
    {isPending ? (
      <ActivityIndicator size="small" color={isFollowing ? '#374151' : '#fff'} />
    ) : (
      <Text style={[
        styles.followButtonText,
        isFollowing && styles.followButtonTextFollowing,
      ]}>
        {isFollowing ? 'Unfollow' : 'Follow'}
      </Text>
    )}
  </Pressable>
)}
```

5. **Add styles:**
```typescript
followButton: {
  backgroundColor: '#3b82f6',
  paddingVertical: 12,
  paddingHorizontal: 32,
  borderRadius: 8,
  marginTop: 24,
  minWidth: 120,
  alignItems: 'center',
},
followButtonFollowing: {
  backgroundColor: '#fff',
  borderWidth: 1,
  borderColor: '#d1d5db',
},
followButtonDisabled: {
  opacity: 0.7,
},
followButtonText: {
  color: '#fff',
  fontSize: 14,
  fontWeight: '600',
},
followButtonTextFollowing: {
  color: '#374151',
},
```

6. **Import Pressable** from react-native (add to existing imports).
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/tim/Documents/GitHub/Tracked && npx tsc --noEmit
```

Verify imports added:
```bash
grep "useFollowUser" app/(app)/profile/\[userId\].tsx
```
  </verify>
  <done>
User profile shows Follow button (blue) or Unfollow button (outlined) depending on follow state. Button shows loading indicator during mutation. Button is disabled while mutation is pending.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create followers and following list screens</name>
  <files>
app/(app)/profile/followers.tsx
app/(app)/profile/following.tsx
  </files>
  <action>
Create two similar screens for followers and following lists.

**followers.tsx:**

1. **Imports:**
```typescript
import { View, Text, FlatList, Pressable, Image, StyleSheet, ActivityIndicator } from 'react-native'
import { useLocalSearchParams, router } from 'expo-router'
import { useFollowers } from '@/features/social'
```

2. **Component:**
- Get userId from useLocalSearchParams
- Use useFollowers(userId) hook
- Show loading state while fetching
- Show empty state if no followers
- Render FlatList of followers

3. **UserListItem** (can be inline or extracted):
```typescript
const renderUser = ({ item: user }) => (
  <Pressable
    style={styles.userItem}
    onPress={() => router.push(`/profile/${user.id}`)}
  >
    {user.avatar_url ? (
      <Image source={{ uri: user.avatar_url }} style={styles.avatar} />
    ) : (
      <View style={styles.avatarPlaceholder}>
        <Text style={styles.avatarInitial}>
          {user.username?.[0]?.toUpperCase() || '?'}
        </Text>
      </View>
    )}
    <Text style={styles.username}>@{user.username}</Text>
  </Pressable>
)
```

4. **Empty state:**
```typescript
{!isLoading && followers?.length === 0 && (
  <View style={styles.emptyState}>
    <Text style={styles.emptyText}>No followers yet</Text>
  </View>
)}
```

5. **Styles** (shared pattern for both screens):
```typescript
const styles = StyleSheet.create({
  container: { flex: 1, backgroundColor: '#fff' },
  centered: { flex: 1, justifyContent: 'center', alignItems: 'center' },
  userItem: {
    flexDirection: 'row',
    alignItems: 'center',
    padding: 16,
    borderBottomWidth: 1,
    borderBottomColor: '#e5e7eb',
  },
  avatar: { width: 48, height: 48, borderRadius: 24, backgroundColor: '#e5e7eb' },
  avatarPlaceholder: {
    width: 48,
    height: 48,
    borderRadius: 24,
    backgroundColor: '#e5e7eb',
    alignItems: 'center',
    justifyContent: 'center',
  },
  avatarInitial: { fontSize: 18, color: '#6b7280', fontWeight: '600' },
  username: { marginLeft: 12, fontSize: 16, color: '#111827', fontWeight: '500' },
  emptyState: { flex: 1, justifyContent: 'center', alignItems: 'center', padding: 24 },
  emptyText: { fontSize: 16, color: '#6b7280' },
})
```

**following.tsx:**
- Same structure as followers.tsx but:
  - Use useFollowing(userId) instead of useFollowers
  - Empty text: "Not following anyone yet"
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/tim/Documents/GitHub/Tracked && npx tsc --noEmit
```

Files exist:
```bash
ls app/(app)/profile/followers.tsx app/(app)/profile/following.tsx
```
  </verify>
  <done>
Both screens render lists of users with avatars and usernames. Tapping a user navigates to their profile. Empty states show when no users in list.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update profile layout and add navigation links</name>
  <files>
app/(app)/profile/_layout.tsx
app/(app)/profile/index.tsx
app/(app)/profile/[userId].tsx
  </files>
  <action>
**_layout.tsx** - Add routes for followers/following:
```typescript
<Stack.Screen name="followers" options={{ title: 'Followers' }} />
<Stack.Screen name="following" options={{ title: 'Following' }} />
```

**index.tsx** (own profile) - Add follower/following counts with navigation:

1. Import useFollowers, useFollowing from @/features/social
2. Import useAuth from @/features/auth
3. Get user from useAuth()
4. Add hooks:
```typescript
const { data: followers } = useFollowers(user?.id || '')
const { data: following } = useFollowing(user?.id || '')
```

5. Add stats row below username (before bio):
```typescript
<View style={styles.statsRow}>
  <Pressable
    style={styles.statItem}
    onPress={() => router.push(`/profile/followers?userId=${user?.id}`)}
  >
    <Text style={styles.statNumber}>{followers?.length ?? 0}</Text>
    <Text style={styles.statLabel}>Followers</Text>
  </Pressable>
  <Pressable
    style={styles.statItem}
    onPress={() => router.push(`/profile/following?userId=${user?.id}`)}
  >
    <Text style={styles.statNumber}>{following?.length ?? 0}</Text>
    <Text style={styles.statLabel}>Following</Text>
  </Pressable>
</View>
```

6. Add styles:
```typescript
statsRow: {
  flexDirection: 'row',
  marginBottom: 16,
},
statItem: {
  alignItems: 'center',
  marginHorizontal: 16,
},
statNumber: {
  fontSize: 18,
  fontWeight: 'bold',
  color: '#111827',
},
statLabel: {
  fontSize: 14,
  color: '#6b7280',
},
```

**[userId].tsx** (other user profile) - Add same stats row:

1. Add useFollowers, useFollowing imports (already have social imports)
2. Add hooks using userId parameter
3. Add same stats row UI and styles
4. Navigation links go to `/profile/followers?userId=${userId}` and `/profile/following?userId=${userId}`
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/tim/Documents/GitHub/Tracked && npx tsc --noEmit
```

Verify routes added:
```bash
grep "followers\|following" app/(app)/profile/_layout.tsx
```
Should show both routes.
  </verify>
  <done>
Profile screens show follower/following counts. Tapping counts navigates to respective list screens. Layout includes routes for followers and following screens.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Files exist:**
```bash
ls -la app/(app)/profile/
```
Should show followers.tsx and following.tsx.

2. **TypeScript:**
```bash
npx tsc --noEmit
```

3. **Manual verification flow:**
   - View another user's profile
   - See Follow button (not on own profile)
   - Tap Follow, see it change to Unfollow
   - Tap follower count, see followers list
   - Tap a user in list, navigate to their profile
</verification>

<success_criteria>
- Follow/Unfollow button appears on other users' profiles (not own)
- Button state reflects current follow relationship
- Optimistic update: button changes immediately on tap
- Followers list screen shows all followers with avatars
- Following list screen shows all following with avatars
- Profile screens show follower/following counts
- Tapping counts navigates to list screens
- Tapping user in list navigates to their profile
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-social-graph/03-03-SUMMARY.md`
</output>
