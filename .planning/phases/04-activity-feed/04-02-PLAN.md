---
phase: 04-activity-feed
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/features/feed/components/FeedItem.tsx
  - src/features/feed/components/FeedList.tsx
  - src/features/feed/components/FeedEmpty.tsx
  - app/(app)/index.tsx
  - src/features/feed/index.ts
autonomous: false

must_haves:
  truths:
    - "User can see activity feed on home tab"
    - "Feed displays log entries with user avatar, username, hobby name, value, notes"
    - "Feed loads more items when scrolling to bottom"
    - "Empty state shows when no followed users have logs"
  artifacts:
    - path: "src/features/feed/components/FeedItem.tsx"
      provides: "Memoized feed entry component"
      min_lines: 40
    - path: "src/features/feed/components/FeedList.tsx"
      provides: "FlatList with infinite scroll"
      min_lines: 50
    - path: "src/features/feed/components/FeedEmpty.tsx"
      provides: "Empty state component"
      min_lines: 15
    - path: "app/(app)/index.tsx"
      provides: "Home tab with feed integration"
      contains: "FeedList"
  key_links:
    - from: "src/features/feed/components/FeedList.tsx"
      to: "src/features/feed/hooks/useFeed.ts"
      via: "useFeed hook consumption"
      pattern: "useFeed\\(\\)"
    - from: "app/(app)/index.tsx"
      to: "src/features/feed/components/FeedList.tsx"
      via: "FeedList component import"
      pattern: "import.*FeedList.*from.*feed"
---

<objective>
Create feed UI components and integrate into home tab screen

Purpose: Delivers the user-facing activity feed with optimized FlatList rendering, infinite scroll pagination, and proper empty state handling. Completes the social feed experience.

Output:
- FeedItem component (memoized, displays single log entry)
- FeedList component (FlatList with infinite scroll, prevents duplicate fetches)
- FeedEmpty component (shown when no feed items)
- Home tab screen integration
</objective>

<execution_context>
@/Users/tim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-activity-feed/04-RESEARCH.md
@.planning/phases/04-activity-feed/04-01-SUMMARY.md

# Feed data layer (from Plan 01)
@src/features/feed/index.ts

# Existing UI patterns
@src/features/logs/components/LogEntry.tsx
@src/features/hobbies/components/HobbyCard.tsx
@app/(app)/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FeedItem and FeedEmpty components</name>
  <files>src/features/feed/components/FeedItem.tsx, src/features/feed/components/FeedEmpty.tsx</files>
  <action>
Create feed display components following existing component patterns:

1. Create src/features/feed/components/FeedItem.tsx:
   - Import React.memo for memoization (critical for FlatList performance)
   - Import FeedLog type from '../services/feed.service'
   - Props: { log: FeedLog }
   - Display card with:
     - User avatar (Image with fallback) and username (top row)
     - Hobby name and tracking value (e.g., "Running: 5 km" or "Reading: 30 min")
     - Note text (if present, truncated to 2 lines)
     - First image from image_urls (if present, with reasonable max height)
     - Relative timestamp (e.g., "2 hours ago") - use simple date formatting
   - Use StyleSheet for styling (consistent with existing components)
   - Wrap entire component in React.memo()

2. Create src/features/feed/components/FeedEmpty.tsx:
   - Simple centered message: "No activity yet"
   - Subtext: "Follow some users to see their progress here"
   - Use StyleSheet, keep minimal

Reference LogEntry.tsx and HobbyCard.tsx for styling patterns.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
FeedItem.tsx renders log entry with user info, hobby, value, notes, image. FeedEmpty.tsx shows empty state message.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FeedList component with infinite scroll</name>
  <files>src/features/feed/components/FeedList.tsx, src/features/feed/index.ts</files>
  <action>
Create FeedList component with optimized FlatList and infinite scroll:

1. Create src/features/feed/components/FeedList.tsx:
   - Import FlatList, ActivityIndicator, RefreshControl from react-native
   - Import useRef, useCallback from react
   - Import useFeed from '../hooks/useFeed'
   - Import FeedItem from './FeedItem'
   - Import FeedEmpty from './FeedEmpty'

   Component implementation:
   - Call useFeed() to get data, fetchNextPage, hasNextPage, isFetchingNextPage, isLoading, refetch, isRefetching
   - Flatten pages: `data?.pages.flatMap(page => page) ?? []`
   - Create ref: `onEndReachedCalledDuringMomentum = useRef(false)`

   FlatList props:
   - data: flattened feed items
   - renderItem: useCallback wrapping FeedItem (MUST be memoized)
   - keyExtractor: useCallback returning item.id
   - ListEmptyComponent: FeedEmpty (only when not loading)
   - ListFooterComponent: ActivityIndicator when isFetchingNextPage
   - onEndReached: Check `!onEndReachedCalledDuringMomentum.current && hasNextPage && !isFetchingNextPage`, then call fetchNextPage() and set flag true
   - onMomentumScrollBegin: Reset flag to false
   - onEndReachedThreshold: 0.5
   - refreshControl: RefreshControl with refreshing=isRefetching, onRefresh=refetch

   Performance props (from research):
   - maxToRenderPerBatch: 10
   - windowSize: 21
   - removeClippedSubviews: true (Android optimization)
   - initialNumToRender: 10

2. Update src/features/feed/index.ts:
   - Add export for FeedList from './components/FeedList'
   - Add export for FeedItem from './components/FeedItem'

Reference research patterns in 04-RESEARCH.md (lines 128-197) for FlatList optimization and onEndReached duplicate prevention.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
FeedList.tsx renders FlatList with infinite scroll, duplicate fetch prevention, pull-to-refresh, and loading states
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate feed into home tab screen</name>
  <files>app/(app)/index.tsx</files>
  <action>
Update home tab to show activity feed:

1. Read current app/(app)/index.tsx implementation
2. Import FeedList from '@/features/feed'
3. Replace current content with FeedList component
4. Keep existing screen wrapper/layout structure
5. Add screen title "Activity" or keep navigation header

The home tab (index.tsx in (app) group) becomes the activity feed.
Keep any existing safe area or layout handling.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
App builds: `npx expo start` (manual check)
  </verify>
  <done>
Home tab renders FeedList showing followed users' activity
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete activity feed with infinite scroll pagination</what-built>
  <how-to-verify>
1. Start the app: `npx expo start`
2. Log in with a test account that follows other users
3. Navigate to home tab (should show feed)
4. Verify feed shows:
   - User avatars and usernames
   - Hobby names with values
   - Notes (if present)
   - Images (if present)
5. Scroll to bottom - should load more items automatically
6. Pull down to refresh - should reload feed
7. If following no users or users have no logs, should show empty state
8. Create a new log entry - feed should update to include it (cache invalidation)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. All feed components export from index.ts
3. Home tab renders FeedList
4. Feed loads and displays items from followed users
5. Infinite scroll loads more pages
6. Empty state shows when appropriate
</verification>

<success_criteria>
- FeedItem displays log entry with all required fields (user, hobby, value, notes, image)
- FeedList uses FlatList with infinite scroll and duplicate fetch prevention
- Home tab shows activity feed
- Pull-to-refresh works
- Empty state shows when no feed items
- Manual verification confirms feed works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/04-activity-feed/04-02-SUMMARY.md`
</output>
